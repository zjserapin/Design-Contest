---
title: "Design Conest"
author: "Zachary Serapin & Andrew Lawrence"
date: "10/27/2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
```{r,message=FALSE}

library(tidyverse)
library(ggplot2)

#read in datasets
pizza_jared <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-01/pizza_jared.csv")
pizza_barstool <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-01/pizza_barstool.csv")
pizza_datafiniti <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-01/pizza_datafiniti.csv")
```

##Starter Plot
Here are the plots from the TidyTuesday submission

```{r,echo=FALSE,warning=FALSE}

# pizza_datafiniti %>% 
#   count(price_range_min, price_range_max)
# 
# 
# pizza_datafiniti %>% 
#   count(province)
# 
# #joining the barstool dataset w/ finiti
# pizza_datafiniti %>% 
#   left_join(pizza_barstool) %>% 
#   count(province, sort=TRUE) %>% 
#   head(20)
# 
# 
# #View(pizza_datafiniti)
# 
# pizza_barstool %>% 
#   count(city) %>% 
#   arrange(desc(n))

#View(pizza_barstool)

pizza_barstool %>%
  select(name, c(contains('average_score'))) %>%
  arrange(desc(review_stats_all_average_score)) %>% 
  head(20) %>% 
  select(-review_stats_critic_average_score,
         -review_stats_all_average_score) %>% 
  mutate(name = fct_reorder(name, review_stats_community_average_score)) %>% 
  gather(key = source, value = average_score, c(contains('average_score'))) %>% 
  mutate(source = fct_recode(source,
                             'Dave' = 'review_stats_dave_average_score',
                             'Everyone' = 'review_stats_community_average_score')) %>%
  ggplot(aes(name, average_score))+
  geom_line(aes(group=name))+
  geom_point(size=2,
             aes(colour=source))+
  coord_flip()+
  labs(y='Average score',
       x= '',
       title = "Dave does not agree",
       subtitle = 'Of the top 20 pizza places, Dave tends to give \npizza places a lower score',
       colour='Source',
       caption = 'Source: Barstool sports \nPlot: @privlko')

theme_set(theme_light())


pizza_barstool %>%
  filter(city== c('Bronx','Brooklyn','New York'))%>% 
  select(name, c(contains('average_score'))) %>%
  arrange(desc(review_stats_all_average_score),
          name) %>%
  head(20) %>% 
  select(name, c(contains('dave'), contains('commun'))) %>% 
  gather(key = source, value = average_score, c(contains('average_score'))) %>% 
  mutate(source = fct_recode(source,
                             'Dave' = 'review_stats_dave_average_score',
                             'Everyone' = 'review_stats_community_average_score'))  %>% 
  arrange(average_score) %>% 
  ggplot(aes(name, average_score))+
  geom_line(aes(group=name))+
  geom_point(size=2,
             aes(colour=source))+
  coord_flip()+
  labs(y='Average score',
       x= '',
       title = "Dave does not agree",
       subtitle = 'Of the top 20 pizza places, Dave tends to give them a lower score',
       colour='Source',
       caption = 'Source: Barstool sports \nPlot: @privlko')

```
## Critique
For this assignment we are asked to analyze the plots and critique them.

What's Good:

- The image clearly labels what is shown
- It uses different colors to separate the two different values being compared
- Connects the two values to show difference in an easily - digestible way
- Uses a horizontal bar graph format


What's Bad:
- Graph is unordered and the title for the graph is unwieldy
- The dots for the values can be difficult to read initially
- Fails to capture the multi-dimensionality of the dataset
- Lacks context:
- Location, Cost, etc.

```{r,warning=FALSE}
#credit:
#https://www.rdocumentation.org/packages/d3heatmap/versions/0.6.1.2/topics/d3heatmap
#https://www.data-to-viz.com/graph/heatmap.html
library(d3heatmap)
library(plotly)
pizza <- pizza_barstool %>%
  filter(city== c('Bronx','Brooklyn','New York'))%>% 
  arrange(desc(review_stats_all_average_score),
          name) %>%
  select(-address1, -longitude, -latitude, -city, -country,-zip) %>%
  head(20)
pizza <- data.frame(pizza, row.names = "name")

library(RColorBrewer)
HeatMap <- d3heatmap(pizza, scale='column', Rowv = TRUE,
            colors='YlGnBu',show_grid=TRUE,
          cexRow=.4, cexCol = .5,anim_duration = 5)

HeatMap

```
# Concept
Concept for Shiny Application

Using a map filter for pizza places in that area, and shows a Interactive Table that allows you to see a varity of ratings from barstool community and critics.

```{r}
library('formattable')
#credit: Tim Bock
#https://www.displayr.com/formattable/
#slide 6 from MULTIDIMENSIONAL & DIMENSIONALITY REDUCTION class on 10/14
F.Table <- formattable(pizza_barstool, list(
  price_level = color_tile("green", "red"),
  provider_rating = formatter("span", style = x ~ ifelse(x >= 3.5, 
                                               style(color = "green", font.weight = "bold"), NA)),
  area(col = c(review_stats_all_average_score, review_stats_all_count, review_stats_all_total_score)) ~ normalize_bar("bisque", 0.2),
  area(col = c(review_stats_critic_average_score, review_stats_critic_count, review_stats_critic_total_score)) ~ normalize_bar("pink", 0.2),
  area(col = c(review_stats_community_average_score, review_stats_community_count, review_stats_community_total_score)) ~ normalize_bar("lightblue", 0.2),
  area(col = c(review_stats_dave_average_score, review_stats_dave_count, review_stats_dave_total_score)) ~ normalize_bar("lightgreen", 0.2)
))

F.Table
```

